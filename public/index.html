<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main Page</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
     <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"></script>
    <style>
        .list-group-item{
            border-radius: 5px;
        }
        .btn-outline-secondary{
            margin: auto; 
            border-radius: 50%; 
            font-size: 50px;
        }
        .card-text{
            font-size: small;
        }
        .card-title{
            font-size: x-large;
        }
    </style>

    <script type="module">
    // Firebase SDK 라이브러리 가져오기
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } 
    from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";


// Firebase 구성 정보 설정
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyCTyiAydhtj3fHT68BQeiJ7zzMe4D9597I",
    authDomain: "sparta-4343d.firebaseapp.com",
    projectId: "sparta-4343d",
    storageBucket: "sparta-4343d.appspot.com",
    messagingSenderId: "323306871299",
    appId: "1:323306871299:web:15070599899f2122e5cc36",
    measurementId: "G-2Y0NR2HZZR"
    };


    // Firebase 인스턴스 초기화
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

        
    $('.like-Btn').click(async function(){
        var currentCount = parseInt($('.like-count').text());
            $('.like-count').text(currentCount + 1);

            let num = $('.like-count').text();
        
        // 넣을 데이터
        let doc = {
            num : num,
            Date : new Date()
        };
        
        await addDoc(collection(db, "num"), doc);
        alert("감사합니다(❁´◡`❁)");
    });
    
    // 가장 최근 데이터 가져오기 함수
    const getLatestDoc = async () => {
        const querySnapshot = await getDocs(
        query(collection(db, "num"), orderBy("Date", "desc"), limit(1))
        );

        if (!querySnapshot.empty) {
            querySnapshot.forEach((doc) => {
                let row = doc.data();
                $('.like-count').html(row['num']);
            });
        }
    };

    getLatestDoc();

    $('.submit').click(async function() {
        let name = $('.name').val();
        let guestBook = $('.guestBook').val();

        if(name != '' && guestBook != ''){
            let doc = {
            name : name,
            guestBook : guestBook
            };
            await addDoc(collection(db, "guestBook"), doc);
            alert("작성 되었습니다.!");
            window.location.reload();
        }else{
            alert("빈칸을 작성해주세요^^");
        }
    });
    let docs = await getDocs(collection(db, "guestBook"));
    docs.forEach((doc) => {
        let row = doc.data();
        console.log(row);

        let name = row['name'];
        let guestBook = row['guestBook'];


        var commnet_html = `            
            <div class="card mb-3">
                <div class="card-body">
                    <h3 class="card-text">${name}</h3>
                    <p class="card-title">${guestBook}</p>
                </div>
            </div>`;

            $(".comments").append(commnet_html);
    }); 
    
    
</script>
</head>
<body>
    <header class="text-center p-4 bg-light">
        <h1>오쪼라고!</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut</p>
    </header>
    
    <section class="container my-5">
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col">
              <div class="card h-100">
                <img src="https://images.unsplash.com/photo-1446768500601-ac47e5ec3719?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1446&q=80" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">이름 : </h5>
                  <p class="card-text">소개 : </p>
                </div>
                    <a href="#" class="btn btn-primary">자세히보기</a>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="https://images.unsplash.com/photo-1446768500601-ac47e5ec3719?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1446&q=80" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">이름 : </h5>
                  <p class="card-text">소개 : </p>
                </div>
                    <a href="#" class="btn btn-primary">자세히보기</a>
              </div>
            </div>
            <div class="col">
              <div class="card h-100">
                <img src="https://images.unsplash.com/photo-1446768500601-ac47e5ec3719?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1446&q=80" class="card-img-top" alt="...">
                <div class="card-body">
                  <h5 class="card-title">이름 : </h5>
                  <p class="card-text">소개 : </p>
                </div>
                    <a href="#" class="btn btn-primary" >자세히보기</a>
              </div>
            </div>
          </div>
    </section>
    
    <section class="container my-5">
        <h2>규칙</h2>
        <ul class="list-group">
          <li class="list-group-item list-group-item-success" >Pull Request 생성시 무엇을 어떻게 수정했는지 이해하기 쉽게 설명하기!</li>
          <p>• 코드 작성후 자신이 학습한 내요을 다시 되돌아 볼 수 있어요.</p>
          <p>• 팀원들이 코드리뷰 할 때 작성된 코드를 쉽게 이해할 수 있어요.</p>
          <li class="list-group-item list-group-item-success">코드 리뷰 1개 이상 달기!</li>
          <p>• 다른 사람이 쓴 코드를 이해하는 능력을 기를 수 있어요. </p>
          <li class="list-group-item list-group-item-success">편하게 질문하고 답하기!</li>
          <p>• 질문하고 답하는 과정에서 깊게 배울 수 있어요.</p>
          <li class="list-group-item list-group-item-danger">말없이 자리 비우지 않기!</li>
          <p>• 질문하고 답하는 과정에서 깊게 배울 수 있어요.</p>
        </ul>
    </section>
    
    <div style="text-align: center;">
        <p>응원하고 싶으시다면 </br>아래 버튼을 눌러주세요!</p>
        <button type="button" class="btn btn-outline-secondary like-Btn" >❤️</button>
        <p class="like-count" >0</p>
    </div>
    
    <section class="container my-5">
        <h2>방명록</h2>
        <form class="mb-4">
            <div class="form-group">
                <input type="text" class="form-control name" placeholder="이름을 입력해주세요..."><br>
                <textarea  class="form-control guestBook" placeholder="방명록을 남겨주세요..."></textarea>
            </div>
            <button type="button" class="btn btn-primary submit">작성하기</button>
        </form>
        <div class="comments">
        </div>
    </section>
</body>
</html>
